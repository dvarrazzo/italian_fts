==============================================
Dizionario per la Ricerca di Testo in Italiano
==============================================

:Autore: Daniele Varrazzo
:Contatto: piro (alla) develer.com
:Organizzazione: `Develer S.r.l. <http://www.develer.com>`__
:Data: 2007-04-25
:Versione: 1.0

:Riassunto: Questo package fornisce un dizionario e gli altri file necessari
    per effettuare la *ricerca full text* in documenti in italiano utilizzando
    il database PostgreSQL_ insieme al package aggiuntivo Tsearch2_.

    La ricerca tiene in considerazione le variazioni caratteristiche della
    lingua italiana per restituire i documenti corrispondenti ai criteri di
    ricerca, ad esempio le diverse coniugazioni verbali. Utilizzando le
    strutture indicizzate di Tsearch2 è possibile effettuare interrogazioni
    efficienti su grandi quantità di dati.

    .. _PostgreSQL: http://www.postgresql.org
    .. _Tsearch2: http://www.sai.msu.su/~megera/postgres/gist/tsearch/V2/


:Copyright: 2001, 2002 Gianluca Turconi
:Copyright: 2002, 2003, 2004 Gianluca Turconi and Davide Prina
:Copyright: 2004, 2005, 2006 Davide Prina
:Copyright: 2007 Daniele Varrazzo

[ `English version <italian-fts.html>`__ ]


This file is distributed under GPL license.

This file is part of the Italian dictionary for full-text search.

The Italian dictionary for full-text search is free software; you can
redistribute it and/or modify it under the terms of the GNU General Public
License as published by the Free Software Foundation; either version 2 of
the License, or (at your option) any later version.

The Italian dictionary for full-text search is distributed in the hope that
it will be useful, but WITHOUT ANY WARRANTY; without even the implied
warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public
License along with Italian dictionary for full-text search,
if not, write to the Free Software Foundation, Inc.,
51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA

GPL license can be found at http://www.fsf.org/licenses/licenses.html


.. Indice::


Informazioni sul dizionario
===========================

Il presente dizionario è stato generato partendo dal dizionario MySpell di
OpenOffice.org, curato dal `progetto linguistico`_.

.. _progetto linguistico: http://linguistico.sourceforge.net/

Il dizionario ha subito una enorme quantità di trasformazioni, ed è ormai
praticamente irriconoscibile rispetto all'originale. In particolare tutte le
forme verbali, compresi i verbi irregolari, vengono fatte risalire
all'infinito. Inoltre per ogni verbo vengono riconosciute le forme pronominali
e riflessive applicabili sull'infinito, l'imperativo, il gerundio e il
participio presente e passato.

Altra cura è stata posta nel ricondurre le diverse persone degli aggettivi e
dei loro superlativi ad una forma normale, ad unificare le forme di maschile
e femminile diverse (ricercatore = ricercatrice, sindaco = sindachessa).

Molti sostantivi apparivano inoltre unificati per ottenere il massimo risparmio
del numero di radici (es. caso/casi + casa/case). Tali sostantivi sono stati
divisi per evitare falsi positivi (purtroppo alcuni "falsi amici" di questo
genere potrebbero ancora gironzolare per il dizionario, perché per individuare
questo genere di problemi non c'è script Python che tenga).

Qualche statistica sulla corrente edizione del dizionario:

- **66.929** radici distinte;
- **7.300** verbi completamente coniugati;
- **1.943.826** termini distinti riconosciuti:
- **62** flag nel file degli affissi;
- **10.365** regole di produzioni nel file degli affissi.


Download
========

La presente edizione del dizionario per la ricerca di testo in Italiano può
essere scaricata dall'indirizzo:

http://www.develer.com/~piro/ispell-italian/ispell-italian-1.0.tar.gz

Potete verificare sulla pagina del progetto se sono disponibili nuove versioni
del dizionario.


Installazione del dizionario
============================

Il package contiene i seguenti file:

``italian.dict``
    elenco delle parole italiane, con i flag che indicano le possibili
    variazioni della parola;

``italian.aff``
    file in formato ISpell con l'elenco delle possibili variazioni delle
    parole;

``italian.stop``
    elenco delle parole da escludere dalla ricerca, in quanto prive di un
    proprio significato (es. congiunzioni, articoli);

La codifica di questi file è ``iso-8859-1`` (detto anche ``latin1``).
Ciò vuol dire che essi sono adatti per essere installati in un backend creato
con encoding ``LATIN1``. Se volete utilizzare il dizionario con un database
creato con encoding ``UTF8`` potete effettuare la conversione dei file con::

    $ iconv -f latin1 -t utf8 < italian.dict > italian_UTF8.dict
    $ iconv -f latin1 -t utf8 < italian.aff  > italian_UTF8.aff
    $ iconv -f latin1 -t utf8 < italian.stop > italian_UTF8.stop

Potrebbe anche esservi utile leggere le informazioni disponibili online
riguardo `Tsearch2 con Unicode/UTF-8`__.

.. __: http://www.sai.msu.su/~megera/postgres/gist/tsearch/V2/
            docs/tsearch2_german_utf8.html

Occorre copiare i file che si intende usare in una directory raggiungibile dal
backend di PostgreSQL. Nel resto del documento verrà usata la directory
``/usr/share/postgresql``: se decidete di usare una diversa directory,
modificate le istruzioni seguenti in maniera consistente.


Configurazione
==============


Installazione di Tsearch2
-------------------------

Si presuppone che la libraria Tsearch2 sia stata installata come descritto
nella documentazione__. Se avete fatto i passi giusti, avrete delle tabelle
simili alle seguenti::

    tstest=# \d
            List of relations
     Schema |     Name     | Type  | Owner
    --------+--------------+-------+-------
     public | pg_ts_cfg    | table | piro
     public | pg_ts_cfgmap | table | piro
     public | pg_ts_dict   | table | piro
     public | pg_ts_parser | table | piro
    (4 rows)

.. __: http://www.sai.msu.su/~megera/postgres/gist/tsearch/V2/
            docs/tsearch-V2-intro.html


Configurazione del dizionario
-----------------------------

Il dizionario va configurato nella tabella ``pg_ts_dict``. Nel campo
``dict_initoption`` occorre sostituire i percorsi indicati nell'esempio con
quelli scelti nel il vostro sistema::

    tstest=# INSERT INTO pg_ts_dict
        (dict_name, dict_comment, dict_init, dict_lexize, dict_initoption)

        SELECT 'it_spell', 'Italian spelling dictionary',
            dict_init, dict_lexize,
            'DictFile="/usr/share/postgresql/italian.dict",'
            'AffFile="/usr/share/postgresql/italian.aff",'
            'StopFile="/usr/share/postgresql/italian.stop"'

        FROM pg_ts_dict
        WHERE dict_name = 'ispell_template';

    INSERT 16627 1

Potete verificare il suo corretto funzionamento richiedendo la *lexizzazione*
di un paio di termini::

    tstest=# SELECT lexize('it_spell', 'Mangiato');
       lexize
    ------------
     {mangiare}
    (1 row)

    tstest=# SELECT lexize('it_spell', 'ma');
     lexize
    --------
     {}
    (1 row)

La prima query mostra che un verbo coniugato viene portato al tempo infinito.
La seconda query mostra che il file delle *stop-word* correttamente esclude
i termini ininfluenti.

La configurazione viene ultimata creando il mapping dal parser (che ha il
compito di dividere le stringhe di input in parole) al dizionario::

    tstest=# INSERT INTO pg_ts_cfg (ts_name, prs_name, locale)
            VALUES ('default_italian', 'default', 'it_IT');
    INSERT 16630 1

    tstest=# INSERT INTO pg_ts_cfgmap
            SELECT 'default_italian', tok_alias, dict_name
            FROM pg_ts_cfgmap
            WHERE ts_name = 'simple';
    INSERT 0 19

    tstest=# UPDATE pg_ts_cfgmap
            SET dict_name = '{it_spell,simple}'
            WHERE ts_name = 'default_italian'
            AND tok_alias IN ('word', 'lword', 'nlword',
                'part_hword', 'lpart_hword', 'nlpart_hword');
    UPDATE 6

    tstest=# UPDATE pg_ts_cfgmap
            SET dict_name = NULL
            WHERE ts_name = 'default_italian'
            AND tok_alias IN ('hword', 'lhword', 'nlhword');
    UPDATE 3

Il valore scelto per il campo ``pg_ts_cfg.locale`` dovrebbe coincidere
con il locale scelto per il database (con il parametro ``--locale`` del comando
``initdb``): per un database con encoding utf8 potrebbe essere corretto
il valore ``it_IT.utf8``.

La configurazione illustrata ha il seguente effetto:

- le parole normali vengono processate dal dizionario italiano;
- le singole parti delle parole separate da un trattino subiscono lo stesso
  processo;
- se il dizionario non riconosce la parola trovata, questa viene lasciata
  inalterata;
- i complessi di parole separate da un trattino vengono ignorati (non sono
  presenti nel dizionario)
- i numeri, le URL, gli indirizzi e-mail, i percorsi di file vengono lasciati
  inalterati.

Per verificare il corretto funzionamento della configurazione, è possibile
utilizzare la funzione ``ts_debug``, che fornisce informazioni sui singoli
token e sulla loro trasformazione in vettore::

    tstest=# SELECT tok_type, description, token, tsvector
    FROM ts_debug($$
    <p>Ma quell'ampolla non aveva l'iscrizione «Veleno». Quindi Alice
    si arrischiò a berne un sorso. Era una bevanda deliziosa (aveva
    un sapore misto di torta di ciliegie, di crema, d'ananasso,
    di gallinaccio arrosto, di torrone, e di crostini imburrati)
    e la tracannò d'un fiato.</p>
    $$);
     tok_type | description |    token    |     tsvector
    ----------+-------------+-------------+-------------------
     lword    | Latin word  | Ma          |
     lword    | Latin word  | quell       |
     lword    | Latin word  | ampolla     | 'ampolla'
     lword    | Latin word  | non         | 'non'
     lword    | Latin word  | aveva       |
     lword    | Latin word  | l           |
     lword    | Latin word  | iscrizione  | 'iscrizione'
     lword    | Latin word  | Veleno      | 'veleno'
     lword    | Latin word  | Quindi      |
     lword    | Latin word  | Alice       | 'alice'
     lword    | Latin word  | si          |
     word     | Word        | arrischiò   | 'arrischiare'
     lword    | Latin word  | a           |
     lword    | Latin word  | berne       | 'bere'
     lword    | Latin word  | un          |
     lword    | Latin word  | sorso       | 'sorso'
     lword    | Latin word  | Era         |
     lword    | Latin word  | una         |
     lword    | Latin word  | bevanda     | 'bevanda'
     lword    | Latin word  | deliziosa   | 'delizioso'
     lword    | Latin word  | aveva       |
     lword    | Latin word  | un          |
     lword    | Latin word  | sapore      | 'sapore'
     lword    | Latin word  | misto       | 'misto'
     lword    | Latin word  | di          |
     lword    | Latin word  | torta       | 'torta' 'torcere'
     lword    | Latin word  | di          |
     lword    | Latin word  | ciliegie    | 'ciliegio'
     lword    | Latin word  | di          |
     lword    | Latin word  | crema       | 'crema' 'cremare'
     lword    | Latin word  | d           |
     lword    | Latin word  | ananasso    | 'ananasso'
     lword    | Latin word  | di          |
     lword    | Latin word  | gallinaccio | 'gallinaccio'
     lword    | Latin word  | arrosto     | 'arrostare'
     lword    | Latin word  | di          |
     lword    | Latin word  | torrone     | 'torrone'
     lword    | Latin word  | e           |
     lword    | Latin word  | di          |
     lword    | Latin word  | crostini    | 'crostino'
     lword    | Latin word  | imburrati   | 'imburrare'
     lword    | Latin word  | e           |
     lword    | Latin word  | la          |
     word     | Word        | tracannò    | 'tracannare'
     lword    | Latin word  | d           |
     lword    | Latin word  | un          |
     lword    | Latin word  | fiato       | 'fiato' 'fiatare'
    (47 rows)


Utilizzo dello *stemmer* come dizionario alternativo
----------------------------------------------------

Con la configurazione illustrata ogni parola non riconosciuta dal dizionario
viene passata al dizionario ``simple``, che la lascia inalterata.
Una possibilità migliore può essere quella di configurare uno *stemmer* come
dizionario secondario: il compito dello stemmer è quello di eliminare le
desinenze variabili delle parole lasciandone solo il tema.

Un tale dizionario potrebbe essere particolarmente utile per particolari
compiti, ad esempio per effettuare ricerche in articoli di giornale. I
giornalisti italiani sono particolarmente creativi nell'inventare neologismi,
(cerchiobottismo, calciopoli, lelemoristi...) dei quali (grazie al cielo!) solo
poche decine finiscono ogni anno nei dizionari ufficiali. Lo stemmer è in grado
di riportare le variazioni più semplici di tali termini ad una radice comune,
aumentando la possibilità di match::

    tstest=# UPDATE pg_ts_cfgmap
            SET dict_name = '{it_spell,it_stem}'
            WHERE ts_name = 'default_italian'
            AND tok_alias IN ('word', 'lword', 'nlword',
                'part_hword', 'lpart_hword', 'nlpart_hword');
    UPDATE 6
    tstest=# SELECT to_tsvector('Cerchiobottisti alla riscossa')
                @@ to_tsquery('cerchiobottismo');
     ?column?
    ----------
     t
    (1 row)

Lo stemmer italiano ha anche la interessante proprietà di lasciare inalterati
la maggior parte dei termini inglesi, probabilmente perché la maggior parte
delle parole inglesi finiscono con una consonante mentre lo stemmer è calibrato
per riconoscere le parole italiane, che per la maggior parte sono terminanti
con una vocale. È quindi possibile usare lo stemmer anche con documenti
contenenti una gran quantità di parole inglesi, senza paura di un eccessivo
numero di falsi positivi.

E' possibile installare uno stemmer seguendo le istruzioni del tool Gendict_
e scaricando le regole di stemming dal sito dello stemmer Snowball_.

.. _Gendict: http://www.sai.msu.su/~megera/postgres/gist/tsearch/V2/
                docs/README.gendict
.. _Snowball: http://snowball.tartarus.org/algorithms/italian/

Potreste trovare qualche difficoltà nel compilare i sorgenti degli stemmer
Snowball con Tsearch2: sembra che ultimamente le interfacce dei due sistemi
siano diventate incompatibili. In rete è comunque possibile trovare indicazioni
su `come far compilare Snowball con Tsearch2`__. Inoltre le `mailing list`__
sono posti accoglienti.

.. __: http://www.mail-archive.com/pgsql-general@postgresql.org/msg94518.html
.. __: https://lists.sourceforge.net/lists/listinfo/openfts-general


Ringraziamenti
==============

Desidero ringraziare **Davide Prina** e **Gianluca Turconi** perché senza il
loro `progetto linguistico`_ non avrei avuto un punto di partenza.

Ringrazio anche **Oleg Bartunov** e **Teodor Sigaev**, autori del progetto
Tsearch2_

E mille grazie alla Develer_, il posto più buono dove mettere un hacker!

...e al mio angelo, che sopporta con pazienza i miei fusi orari.

.. _Develer: http://www.develer.com
